Note of 《The Docker Book》
=

##Chapter 3


###1.check the status of docker,using the following command
```
[root@docker ~]# docker info
Containers: 0
Images: 39
Storage Driver: devicemapper
 Pool Name: docker-253:1-13788-pool
 Pool Blocksize: 65.54 kB
 Backing Filesystem: xfs
 Data file: /dev/loop0
 Metadata file: /dev/loop1
 Data Space Used: 2.683 GB
 Data Space Total: 107.4 GB
 Data Space Available: 14.91 GB
 Metadata Space Used: 2.884 MB
 Metadata Space Total: 2.147 GB
 Metadata Space Available: 2.145 GB
 Udev Sync Supported: true
 Deferred Removal Enabled: false
 Data loop file: /var/lib/docker/devicemapper/devicemapper/data
 Metadata loop file: /var/lib/docker/devicemapper/devicemapper/metadata
 Library Version: 1.02.93-RHEL7 (2015-01-28)
Execution Driver: native-0.2
Logging Driver: json-file
Kernel Version: 3.10.0-229.14.1.el7.x86_64
Operating System: CentOS Linux 7 (Core)
CPUs: 1
Total Memory: 2.782 GiB
Name: docker
ID: LXP2:VH6A:V7JE:NQGB:ZWW6:RZCQ:IH2X:ELTI:JC2P:G4RJ:NKIX:J2FS
```
	
###2.how to get help
```
[root@dockerh ~]# docker help
Usage: docker [OPTIONS] COMMAND [arg...]

A self-sufficient runtime for linux containers.

Options:

  --add-registry=[]                    Registry to query before a public one
...

or 

[root@dockerh ~]# man docker-run

or 

[root@dockerh ~]# docker help run

Usage: docker run [OPTIONS] IMAGE [COMMAND] [ARG...]

Run a command in a new container

  -a, --attach=[]             Attach to STDIN, STDOUT or STDERR
  --add-host=[]               Add a custom host-to-IP mapping (host:ip)
  --blkio-weight=0            Block IO (relative weight), between 10 and 1000

same with following command

[root@dockerh ~]# docker run --help

Usage: docker run [OPTIONS] IMAGE [COMMAND] [ARG...]

Run a command in a new container

  -a, --attach=[]             Attach to STDIN, STDOUT or STDERR
  --add-host=[]               Add a custom host-to-IP mapping (host:ip)
```
> **Tip:** access this official page to get help [Use the Docker command line](https://docs.docker.com/engine/reference/commandline/cli/)

###3.create a container
```
[root@dockerh ~]# docker run -i -t ubuntu /bin/bash
```
-i: The -i flag keeps STDIN open from the container
-t: The -t flag is the other half and tells Docker
to assign a pseudo-tty to the container we're about to create
###4.running commands in the container
```
root@e2c3cb20b54c:/# hostname
>e2c3cb20b54c

root@e2c3cb20b54c:/# cat /etc/hosts
>172.17.0.2	e2c3cb20b54c
>127.0.0.1	localhost
...

root@e2c3cb20b54c:/#  **ip a**
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
6: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default 
    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.2/16 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::42:acff:fe11:2/64 scope link 
       valid_lft forever preferred_lft forever
```
>**Tip:**
>1. the hostname is the container ID
>2. when we type *exit* from container,what's will happen?
>    Once we exited the container, that command ended, and the container was
stopped.

###5.about *ps* command 
```
[root@dockerh ~]# docker ps -a
[root@dockerh ~]# docker ps -l
[root@dockerh ~]# docker ps -q
```
>1. -l flag to show the last container that was run, whether it is running or stopped.
>2. -a flag, the docker ps command will show us all containers, both stopped and running.
>3. -q flag show the IDs of containers

###6 name a container
```
 [root@dockerh ~]# docker run --name ashang_test -i -t ubuntu /bin/bash
```

### 7 start the stopped container by name or ID
```
[root@dockerh ~]# docker start ashang_test
[root@dockerh ~]# docker start e211325fa095
```
> you can also use ***docker restart xxx***
### 8. attach a container by name or ID
```
[root@dockerh ~]# docker attach ashang_test
[root@dockerh ~]# docker attach e211325fa095
```
>1. the status of container should be running,so if it is stopped ,you need start it first.
>2. the following commands work fine:
>***docker restart ashang_test;docker attach ashang_test***  
      ***docker restart ashang_test && docker attach ashang_test***   

### 9 creating a daemonized container
```
[root@dockerh ~]# run --name daemon_dave_1 -d ubuntu /bin/bash -c "while true;do echo hello world; sleep 1; done"
```
>-d flag to tell Docker to detach the container to the background.

### 10 see what happen in the container
```
[root@dockerh ~]# docker logs daemon_dave_1 
[root@dockerh ~]# docker logs 6da2a1a3678d
hello world
hello world
hello world
...

[root@dockerh ~]# docker logs -f 6da2a1a3678d

[root@dockerh ~]# docker logs --tail 10 -t 6da2a1a3678d
```
>--tail=100, show the last 100 lines of logs
>-t: with timestamp
>-f: like tail -f ,but you need make sure the container is running, CTRL+C to stop it

###11 inspecting the container's process	
```
[root@dockerh ~]# docker top 6da2a1a3678d
```
###12 stop/kill a daemonized container
```
[root@dockerh ~]# docker stop 6da2a1a3678d
[root@dockerh ~]# docker kill 6da2a1a3678d
```
> docker kill ID is much more enthusiastically,
>docker ps -n x flag which shows the last x containers

### 13 inspect the inside of container
```
[root@dockerh ~]# docker inspect 6da2a1a3678d
[root@dockerh ~]# docker inspect --format='{{ .State.Running }}' 6da2a1a3678d
[root@dockerh ~]# docker inspect --format='{{ .Image }}' 6da2a1a3678d
[root@dockerh ~]# docker inspect --format='{{ .Config.Cmd }}' 6da2a1a3678d
```

###14 delete a container
```
[root@dockerh containers]# docker rm 6da2a1a3678d
[root@dockerh containers]# docker rm `docker ps -a -q`
```

##Chapter 4
###1.pull an image from docker.io
```
[root@dockerh ~]# docker pull centos
[root@dockerh ~]# docker pull fedora
[root@dockerh ~]# docker pull ubuntu
[root@dockerh ~]# docker pull jamtur01/puppetmaster
```
###2. search a image
```
[root@dockerh ~]# docker search centos
[root@dockerh ~]# docker search puppet
```
###3.login docker.io
```
[root@dockerh ~]# docker login
```
###4.commit a custom image
```
[root@dockerh ~]# docker run -i -t ubuntu /bin/bash
root@dc33f96c57a3:/# apt-get -y install apache2

[root@dockerh ~]# docker commit dc33f96c57a3 shangaijun/test
9b1f46447696fd8bbf2d7ab9e429f0eeeaed69a4d98b70828d8ab81a0c80a50b
[root@dockerh ~]# docker images
REPOSITORY                                     TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
shangaijun/test                                latest              9b1f46447696        24 seconds ago      224 MB


[root@dockerh ~]# docker commit -m="what is this images" --author="Shangaijun" dc33f96c57a3 shangaijun/test:webserver
6adb8ab5aaccbacce5d6762b9da6cb7ef4c42a0ec60e4a8608c5fc6c988ba0dc
[root@dockerh ~]# docker images
REPOSITORY                                     TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
shangaijun/test                                webserver           6adb8ab5aacc        5 seconds ago       224 MB
shangaijun/test                                latest              9b1f46447696        2 minutes ago       224 MB
```
>-m option which allows us to provide a commit message explaining our new image
>--author option to list the author of the image
>shangaijun/test:webserver, and we've added a tag, webserver, to our image.

###5 build a container with self build image
```
[root@dockerh ~]# docker run -i -t shangaijun/test:webserver /bin/bash
```
###6.build a image with Dockerfile
```
[root@dockerh ~]# mkdir -p static_web
[root@dockerh ~]# cd static_web
[root@dockerh static_web]# cat Dockerfile 
#Version: 0.0.1

From ubuntu:latest
MAINTAINER Aijun Shang "ashang@redhat.com"
RUN apt-get update
RUN apt-get install -y nginx
RUN echo 'Hi, I am in your container' > /usr/share/nginx/html/index.html
EXPOSE 80

[root@dockerh static_web]# docker build -t="shangaijun/static_web" .
Sending build context to Docker daemon 2.048 kB
Sending build context to Docker daemon 
Step 0 : FROM ubuntu:latest
 ---> a5a467fddcb8
Step 1 : MAINTAINER Aijun Shang "ashang@redhat.com"
 ---> Using cache
 ---> e79e770e2159
Step 2 : RUN apt-get update
 ---> Using cache
 ---> a44ef96fb6f3
Step 3 : RUN apt-get install -y nginx
 ---> Using cache
 ---> 399cf859b4b7
Step 4 : RUN echo 'Hi, I am in your container' > /usr/share/nginx/html/index.html
 ---> Using cache
 ---> 560d7417b231
Step 5 : EXPOSE 80
 ---> Using cache
 ---> cb2ea4eb9177
Successfully built cb2ea4eb9177

[root@dockerh static_web]# docker images shangaijun/static_web
REPOSITORY              TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
shangaijun/static_web   latest              cb2ea4eb9177        6 months ago        227.3 MB


[root@dockerh static_web]# docker build -t="shangaijun/static_web:v1" .
[root@dockerh static_web]# docker build -t="shangaijun/static_web:v2" .
[root@dockerh static_web]# docker build -t="shangaijun/static_web:v3" .

[root@dockerh static_web]# docker images
REPOSITORY                                     TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
shangaijun/static_web                          latest              cb2ea4eb9177        6 months ago        227.3 MB
shangaijun/static_web                          v1                  cb2ea4eb9177        6 months ago        227.3 MB
shangaijun/static_web                          v2                  cb2ea4eb9177        6 months ago        227.3 MB
shangaijun/static_web                          v3                  cb2ea4eb9177        6 months ago        227.3 MB
```
>If you don't specify any tag, Docker will automatically tag your image as latest.
>build an image without cache ---> docker build --no-cache -t="shangaijun/static_web" .
###7. building from a Git repository
```
docker build -t="shangaijun/static_web:v1" git@github.com:shangaijun/docker-static_web
```

###8.see the process of building image
```
[root@dockerh static_web]# docker history 6adb8ab5aacc
IMAGE               CREATED             CREATED BY                                      SIZE                COMMENT
6adb8ab5aacc        34 minutes ago      /bin/bash                                       36.13 MB            
a5a467fddcb8        6 months ago        /bin/sh -c #(nop) CMD ["/bin/bash"]             0 B                 
ac65c371c3a5        6 months ago        /bin/sh -c sed -i 's/^#\s*\(deb.*universe\)$/   1.895 kB            
9e19ac89d27c        6 months ago        /bin/sh -c echo '#!/bin/sh' > /usr/sbin/polic   194.5 kB            
3fd0c2ae8ed2        6 months ago        /bin/sh -c #(nop) ADD file:e97fe9bddafcfac4ca   187.7 MB 
```
###9. running a container with self-build image
```
[root@dockerh static_web]# docker run -d -p 80 --name web_static shangaijun/static_web nginx -g "daemon off;"

[root@dockerh static_web]# docker ps -l
CONTAINER ID        IMAGE                   COMMAND                CREATED             STATUS              PORTS                   NAMES
94746e1a4566        shangaijun/static_web   "nginx -g 'daemon of   4 seconds ago       Up 4 seconds        0.0.0.0:32769->80/tcp   web_static

[root@dockerh static_web]# docker port  94746e1a4566 80
0.0.0.0:32769
```
>**docker->container   32769->80**
```
[root@dockerh static_web]# docker run -d -p 80:80 --name web_static shangaijun/static_web nginx -g "daemon off;"
ac936eb90e20b807740c46eaac97a0a5e8ffc08fad0a51d2fa96a980ce27c153
```
>This will bind port 80 on the container to port 80 on the local host  **docker->container   32769->80**
```
[root@dockerh static_web]# docker run -d -p 8080:80 --name web_static shangaijun/static_web nginx -g "daemon off;"
ac936eb90e20b807740c46eaac97a0a5e8ffc08fad0a51d2fa96a980ce27c153
```
>This would bind port 80 on the container to port 8080 on the local host
```
[root@dockerh static_web]# docker run -d -p 127.0.0.1:8080:80 --name web_static shangaijun/static_web nginx -g "daemon off;"
ac936eb90e20b807740c46eaac97a0a5e8ffc08fad0a51d2fa96a980ce27c153
```
>Binding to a random port on a specific interface








###n some basic knowledge about docker
- 1.all the containers located in /var/lib/docker/containers, **all information** about container could be found in this folder
-  dfd
##Reference:
[1]. [Use the Docker command line](https://docs.docker.com/engine/reference/commandline/cli/)
